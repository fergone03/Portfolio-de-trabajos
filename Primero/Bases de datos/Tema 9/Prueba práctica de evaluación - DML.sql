DROP SCHEMA IF EXISTS DML;

CREATE SCHEMA DML;

USE DML;

CREATE TABLE PROFESOR (
ID INT PRIMARY KEY AUTO_INCREMENT , 
NOMBRE VARCHAR(20), 
ÁREA_CONOCIMIENTO VARCHAR(20), 
CATEGORÍA VARCHAR (20)
);
CREATE TABLE DEPARTAMENTO (
ID INT PRIMARY KEY AUTO_INCREMENT, 
NOMBRE VARCHAR(20) UNIQUE, 
ID_DIRECTOR INT,

    FOREIGN KEY (ID_DIRECTOR) REFERENCES PROFESOR(ID)
);
CREATE TABLE GRUPO (
ID INT  PRIMARY KEY AUTO_INCREMENT, 
MÁXIMO_ALUMNOS INT CONSTRAINT CHECK (MÁXIMO_ALUMNOS <= 30), 
TIPO TINYTEXT
);
CREATE TABLE GRUPO_TEORÍA (
ID_GRUPO INT PRIMARY KEY, 
HORAS_CLASE INT CHECK(HORAS_CLASE BETWEEN 4 AND 300),

    FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO(ID)

);
CREATE TABLE GRUPO_PRÁCTICA (
ID_GRUPO INT PRIMARY KEY, 
TALLER_OCUPADO VARCHAR(20) DEFAULT"Laboratorio 1",

    FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO(ID)

);
CREATE TABLE ALUMNO (
DNI VARCHAR(9) PRIMARY KEY, 
FECHA_NACIMIENTO DATE, 
NOMBRE VARCHAR(20), 
TIENE_BECA BOOL DEFAULT (FALSE)
);
CREATE TABLE ASIGNATURA (
ID INT  PRIMARY KEY AUTO_INCREMENT, 
NOMBRE VARCHAR(20), 
CRÉDITOS INT, 
CARÁCTER CHAR, 
CURSO VARCHAR(2)   
CONSTRAINT ASIGNATURA CHECK (CURSO IN ("1º","2º","3º","4º"))

);
CREATE TABLE PROFESOR_IMPARTE_GRUPO (
NRP INT, 
ID_GRUPO INT,

    PRIMARY KEY (NRP, ID_GRUPO),
	FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO(ID)

);
CREATE TABLE ASIGNATURA_SE_IMPARTE_EN_GRUPO (
ID_GRUPO INT auto_increment, 
ID_ASIGNATURA INT,

    PRIMARY KEY (ID_GRUPO, ID_ASIGNATURA),
    FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO(ID),
    FOREIGN KEY (ID_ASIGNATURA) REFERENCES ASIGNATURA(ID)

);
CREATE TABLE MATRÍCULA (
DNI_ALUMNO VARCHAR(9), 
ID_GRUPO INT, 
ID_ASIGNATURA INT, 
FECHA DATE,

    PRIMARY KEY (DNI_ALUMNO,ID_GRUPO,ID_ASIGNATURA,FECHA),
    FOREIGN KEY (ID_GRUPO) REFERENCES GRUPO(ID),
    FOREIGN KEY (ID_ASIGNATURA) REFERENCES ASIGNATURA(ID)

);

INSERT INTO GRUPO (ID, MÁXIMO_ALUMNOS, TIPO) VALUES
(3223434, 29, "CIENCIAS"),
(8658734, 12, "LETRAS"),
(4423434, 23, "ROBÓTICA"),
(1234567, 16, "INFORMÁTICA");
INSERT INTO ASIGNATURA (ID, NOMBRE, CRÉDITOS, CARÁCTER, CURSO) VALUES
(1, "MATES" ,30,"A", "1º"),
(2, "CONO",30,"A", "2º"),
(3, "CHAMBA",30,"A", "3º"),
(4, "PAN",30,"A", "4º");

INSERT INTO MATRÍCULA (DNI_ALUMNO, ID_GRUPO, ID_ASIGNATURA, FECHA) VALUES
("77993944R", 3223434, '1', '2023-05-15'),
("24259122D", 8658734, '2', '2023-05-16'),
("33237543X", 4423434, '1', '2023-05-15');

INSERT INTO GRUPO_TEORÍA (ID_GRUPO, HORAS_CLASE) VALUES
    ('3223434', 100),
    ('4423434', 200);
    
INSERT INTO GRUPO_PRÁCTICA (ID_GRUPO, TALLER_OCUPADO) VALUES
    ('8658734', 6),
    ('1234567', FALSE);

